<!-- templates/registration/change_password.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Ubah Password - MancingMo{% endblock %}

{% block content %}
<div class="change-password-container">
    <div class="password-header">
        <h1>Ubah Password</h1>
        <p>Jaga keamanan akun Anda dengan memperbarui password secara berkala</p>
    </div>

    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="password-content">
        <form method="POST" class="password-form">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="id_old_password">Password Saat Ini</label>
                <input type="password" id="id_old_password" name="old_password" class="form-input" required>
                {% if form.old_password.errors %}
                <ul class="errorlist">
                    {% for error in form.old_password.errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="id_new_password1">Password Baru</label>
                <input type="password" id="id_new_password1" name="new_password1" class="form-input" required>
                <small class="form-help">Password harus minimal 8 karakter dan mengandung huruf dan angka</small>
                {% if form.new_password1.errors %}
                <ul class="errorlist">
                    {% for error in form.new_password1.errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="id_new_password2">Konfirmasi Password Baru</label>
                <input type="password" id="id_new_password2" name="new_password2" class="form-input" required>
                {% if form.new_password2.errors %}
                <ul class="errorlist">
                    {% for error in form.new_password2.errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>

            <div class="password-strength">
                <div class="strength-meter">
                    <div class="strength-bar"></div>
                </div>
                <span class="strength-text">Kekuatan password</span>
            </div>

            <div class="requirements-section">
                <h4>Persyaratan Password:</h4>
                <ul class="requirements-list">
                    <li id="req-length" class="requirement">Minimal 8 karakter</li>
                    <li id="req-letters" class="requirement">Mengandung huruf</li>
                    <li id="req-numbers" class="requirement">Mengandung angka</li>
                    <li id="req-match" class="requirement">Password cocok</li>
                </ul>
            </div>

            <div class="security-tips">
                <h4>Tips Keamanan</h4>
                <ul class="tips-list">
                    <li>Gunakan password unik untuk akun ini</li>
                    <li>Jangan bagikan password dengan siapa pun</li>
                    <li>Ubah password secara berkala</li>
                    <li>Gunakan kombinasi huruf besar, huruf kecil, angka, dan simbol</li>
                    <li>Hindari menggunakan informasi pribadi dalam password</li>
                </ul>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-primary">
                    <i class="fas fa-key"></i> Perbarui Password
                </button>
                <a href="{% url 'profile' %}" class="btn-secondary">
                    <i class="fas fa-times"></i> Batal
                </a>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const newPassword = document.getElementById('id_new_password1');
    const confirmPassword = document.getElementById('id_new_password2');
    const strengthBar = document.querySelector('.strength-bar');
    const strengthText = document.querySelector('.strength-text');
    
    function checkPasswordStrength(password) {
        let strength = 0;
        
        // Cek panjang
        if (password.length >= 8) strength++;
        
        // Cek huruf
        if (/[a-zA-Z]/.test(password)) strength++;
        
        // Cek angka
        if (/[0-9]/.test(password)) strength++;
        
        // Cek karakter khusus
        if (/[^a-zA-Z0-9]/.test(password)) strength++;
        
        return strength;
    }
    
    function updateRequirements(password, confirm) {
        // Persyaratan panjang
        document.getElementById('req-length').style.color = password.length >= 8 ? '#22c55e' : '#ef4444';
        
        // Persyaratan huruf
        document.getElementById('req-letters').style.color = /[a-zA-Z]/.test(password) ? '#22c55e' : '#ef4444';
        
        // Persyaratan angka
        document.getElementById('req-numbers').style.color = /[0-9]/.test(password) ? '#22c55e' : '#ef4444';
        
        // Persyaratan kecocokan
        document.getElementById('req-match').style.color = password === confirm && password !== '' ? '#22c55e' : '#ef4444';
    }
    
    function updateStrengthMeter(strength) {
        const colors = ['#ef4444', '#f59e0b', '#84cc16', '#22c55e'];
        const texts = ['Sangat Lemah', 'Lemah', 'Baik', 'Kuat'];
        
        strengthBar.style.width = `${(strength / 4) * 100}%`;
        strengthBar.style.backgroundColor = colors[strength - 1] || '#ef4444';
        strengthText.textContent = texts[strength - 1] || 'Sangat Lemah';
    }
    
    newPassword.addEventListener('input', function() {
        const strength = checkPasswordStrength(this.value);
        updateStrengthMeter(strength);
        updateRequirements(this.value, confirmPassword.value);
    });
    
    confirmPassword.addEventListener('input', function() {
        updateRequirements(newPassword.value, this.value);
    });
});
</script>
{% endblock %}