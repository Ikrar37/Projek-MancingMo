{% load static %}

<!-- Navigation -->
<nav>
    <div class="logo">
        <a href="{% url 'home' %}">
            <img src="{% static 'image/logo mancingmo.png' %}" alt="MancingMo Logo">
        </a>
    </div>
    <ul class="nav-links">
        <li><a href="{% url 'home' %}">Home</a></li>
        <li><a href="{% url 'shop' %}">Shop</a></li>
        <li><a href="{% url 'about' %}">About</a></li>
        <li><a href="{% url 'contact' %}">Contact</a></li>
    </ul>
    <div class="nav-icons">
        <!-- ✅ CART ICON DENGAN BADGE - MENGHITUNG PRODUK UNIK -->
        <a href="{% url 'cart' %}" class="icon-link cart-icon-wrapper">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
            </svg>
            {% if user.is_authenticated %}
            <span class="cart-badge" id="cartBadge">
                {% if user.cart.get_unique_items_count > 0 %}{{ user.cart.get_unique_items_count }}{% endif %}
            </span>
            {% endif %}
        </a>
        
        {% if user.is_authenticated %}
        <!-- User Menu Dropdown -->
        <div class="user-menu">
            <button class="user-btn">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                <span class="user-name">{{ user.first_name|default:user.username }}</span>
            </button>
            <div class="dropdown-menu">
                <a href="{% url 'profile' %}" class="dropdown-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="18">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                    Profile Saya
                </a>
                <a href="{% url 'order_history' %}" class="dropdown-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="18">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                    </svg>
                    Pesanan Saya
                </a>
                <form method="POST" action="{% url 'logout' %}" style="margin: 0; padding: 0;">
                    {% csrf_token %}
                    <button type="submit" class="dropdown-item logout">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                        </svg>
                        Logout
                    </button>
                </form>
            </div>
        </div>
        {% else %}
        <!-- Login Button -->
        <a href="{% url 'login' %}" class="icon-link">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
        </a>
        {% endif %}
    </div>
</nav>

<script>
// Toggle dropdown menu
document.addEventListener('DOMContentLoaded', function() {
    const userBtn = document.querySelector('.user-btn');
    const dropdownMenu = document.querySelector('.dropdown-menu');
    
    if (userBtn && dropdownMenu) {
        userBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            dropdownMenu.classList.toggle('show');
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.user-menu')) {
                dropdownMenu.classList.remove('show');
            }
        });
    }
});

// ✅ FUNGSI UPDATE CART BADGE - MENGHITUNG PRODUK UNIK
function updateCartBadge(count) {
    const badge = document.getElementById('cartBadge');
    if (badge) {
        if (count > 0) {
            badge.textContent = count;
            badge.style.display = 'flex';
        } else {
            badge.style.display = 'none';
        }
    }
}

// Make function available globally
window.updateCartBadge = updateCartBadge;
</script>